<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Cormorant+Garamond:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cormorant Garamond', serif;
            background-color: #1a2238; /* 深いネイビーの背景 */
            color: #d4af37; /* ゴールドのテキスト色 */
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h1 {
            font-family: 'Playfair Display', serif;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }
        .container {
            background-color: #232f4e;
            padding: 30px;
            border: 2px solid #d4af37;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            width: 100%;
            max-width: 500px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            letter-spacing: 1px;
        }
        input[type="text"], input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #d4af37;
            background-color: #1a2238;
            color: #fff;
            border-radius: 4px;
            box-sizing: border-box; 
        }
        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(to bottom, #e6c766, #d4af37);
            border: none;
            color: #1a2238;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background: linear-gradient(to bottom, #f0d88b, #e6c766);
        }
        #preview-container {
            margin-top: 30px;
            text-align: center;
            display: none; 
        }
        canvas {
            max-width: 100%;
            height: auto;
            border: 3px solid #d4af37;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        #download-btn {
            margin-top: 15px;
            background: linear-gradient(to bottom, #fff, #e0e0e0);
            color: #1a2238;
        }
    </style>
</head>
<body>

    <h1>Certificate Generator</h1>

    <div class="container">
        <div class="input-group">
            <label for="photo-upload">PHOTO (顔写真):</label>
            <input type="file" id="photo-upload" accept="image/*">
        </div>
        <div class="input-group">
            <label for="name-input">NAME (氏名):</label>
            <input type="text" id="name-input" placeholder="例: Taro Yamada">
        </div>
        <div class="input-group">
            <label for="dept-input">DEPARTMENT (部署):</label>
            <input type="text" id="dept-input" placeholder="例: Sales Division">
        </div>
        <div class="input-group">
            <label for="pos-input">POSITION (役職):</label>
            <input type="text" id="pos-input" placeholder="例: Manager">
        </div>
        <button onclick="generateCertificate()">認定証を作成</button>
    </div>

    <div id="preview-container">
        <h2>Preview</h2>
        <canvas id="certificateCanvas" width="1535" height="1535"></canvas>
        <br>
        <a id="download-link" download="GLAM_MEMBER.png">
            <button id="download-btn">画像をダウンロード (印刷用高画質)</button>
        </a>
    </div>

    <script>
        let uploadedImage = null;
        const photoInput = document.getElementById('photo-upload');
        const canvas = document.getElementById('certificateCanvas');
        const ctx = canvas.getContext('2d');
        const previewContainer = document.getElementById('preview-container');
        const downloadLink = document.getElementById('download-link');

        const fontLoadPromise = document.fonts.ready;

        photoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    uploadedImage = new Image();
                    uploadedImage.onload = function() {
                        console.log("Image loaded successfully");
                    };
                    uploadedImage.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        async function generateCertificate() {
            await fontLoadPromise;

            const name = document.getElementById('name-input').value || ' ';
            const dept = document.getElementById('dept-input').value || ' ';
            const pos = document.getElementById('pos-input').value || ' ';

            // 1. 背景描画
            const grad = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            grad.addColorStop(0, '#1a2238');
            grad.addColorStop(1, '#232f4e');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. 外枠装飾（太くして高級感を）
            ctx.strokeStyle = '#d4af37';
            ctx.lineWidth = 20;
            ctx.strokeRect(30, 30, canvas.width - 60, canvas.height - 60);
            ctx.lineWidth = 4;
            ctx.strokeRect(55, 55, canvas.width - 110, canvas.height - 110);

            // 3. タイトル描画 (Playfair Displayに変更)
            ctx.fillStyle = '#d4af37';
            ctx.textAlign = 'center';
            // フォントサイズを大きく 100px -> 120px
            ctx.font = 'bold 120px "Playfair Display", serif'; 
            ctx.fillText('GLAM GROUP MEMBER', canvas.width / 2, 180);

            // 4. 写真描画エリア
            // テキストエリアを確保するため、写真は少し上に、サイズはバランス調整
            const photoSize = 750; 
            const photoY = 250; 
            const photoX = (canvas.width - photoSize) / 2;

            // 写真の枠
            ctx.strokeStyle = '#d4af37';
            ctx.lineWidth = 8;
            ctx.strokeRect(photoX - 8, photoY - 8, photoSize + 16, photoSize + 16);

            // 写真の描画
            if (uploadedImage) {
                ctx.save();
                ctx.beginPath();
                ctx.rect(photoX, photoY, photoSize, photoSize);
                ctx.clip();

                const scale = Math.max(photoSize / uploadedImage.width, photoSize / uploadedImage.height);
                const x = photoX + (photoSize - uploadedImage.width * scale) / 2;
                const y = photoY + (photoSize - uploadedImage.height * scale) / 2;
                ctx.drawImage(uploadedImage, x, y, uploadedImage.width * scale, uploadedImage.height * scale);
                ctx.restore();
            } else {
                ctx.fillStyle = '#2a3a5e';
                ctx.fillRect(photoX, photoY, photoSize, photoSize);
                ctx.fillStyle = '#d4af37';
                ctx.textAlign = 'center';
                ctx.font = '50px "Cormorant Garamond", serif';
                ctx.fillText('NO PHOTO', canvas.width / 2, photoY + photoSize / 2);
            }

            // 5. テキスト情報描画 (印刷用に大きく)
            const textStartY = photoY + photoSize + 120; // 写真の下に余白をとる
            const lineHeight = 110; // 行間を広げる
            
            const labelX = 180; // 左端のマージン
            const valueX = canvas.width - 180; // 右端のマージン

            ctx.fillStyle = '#d4af37'; 

            // NAME
            ctx.textAlign = 'left';
            ctx.font = 'bold 55px "Cormorant Garamond", serif'; // ラベルサイズUP
            ctx.fillText('NAME :', labelX, textStartY);

            ctx.textAlign = 'right';
            ctx.fillStyle = '#ffffff'; 
            ctx.font = 'bold 85px "Cormorant Garamond", serif'; // 名前サイズ大幅UP
            ctx.fillText(name, valueX, textStartY);

            // DEPARTMENT
            ctx.fillStyle = '#d4af37';
            ctx.textAlign = 'left';
            ctx.font = 'bold 55px "Cormorant Garamond", serif';
            ctx.fillText('DEPARTMENT :', labelX, textStartY + lineHeight);

            ctx.fillStyle = '#ffffff';
            ctx.textAlign = 'right';
            ctx.font = 'bold 85px "Cormorant Garamond", serif'; // 値サイズUP
            ctx.fillText(dept, valueX, textStartY + lineHeight);

            // POSITION
            ctx.fillStyle = '#d4af37';
            ctx.textAlign = 'left';
            ctx.font = 'bold 55px "Cormorant Garamond", serif';
            ctx.fillText('POSITION :', labelX, textStartY + lineHeight * 2);

            ctx.fillStyle = '#ffffff';
            ctx.textAlign = 'right';
            ctx.font = 'bold 85px "Cormorant Garamond", serif'; // 値サイズUP
            ctx.fillText(pos, valueX, textStartY + lineHeight * 2);

            // 6. 日付（フッター）
            const today = new Date();
            const dateString = today.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            ctx.fillStyle = '#d4af37';
            ctx.textAlign = 'center';
            ctx.font = '35px "Cormorant Garamond", serif';
            ctx.fillText(`Presented on ${dateString}`, canvas.width / 2, canvas.height - 40);

            // プレビュー表示
            previewContainer.style.display = 'block';
            downloadLink.href = canvas.toDataURL('image/png');
            previewContainer.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
